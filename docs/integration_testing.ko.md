# 통합 테스팅 (Integration Testing)

이 문서는 애플리케이션의 통합 테스트 설정에 대한 개요와 테스트 실행 방법을 제공합니다.

## 통합 테스트의 목적

통합 테스트는 애플리케이션의 여러 부분이 함께 올바르게 작동하는지 확인하기 위해 설계되었습니다. 개별 구성 요소를 격리하여 테스트하는 단위 테스트와 달리, 통합 테스트는 애플리케이션의 비즈니스 로직, 데이터 접근 계층, 데이터베이스와 같은 구성 요소 간의 상호 작용에 중점을 둡니다.

현재 통합 테스트 스위트는 다음을 다룹니다:

- **SQLAlchemy Cart Repository:** 리포지토리가 데이터베이스에서 카트 데이터를 올바르게 저장, 조회, 업데이트, 삭제할 수 있는지 확인합니다.
- **Unit of Work (UoW):** 데이터베이스 트랜잭션이 성공 시 커밋되고 실패 시 롤백되는 등 올바르게 관리되는지 검증합니다.
- **CQRS 핸들러:** 커맨드 및 쿼리 핸들러가 리포지토리 및 데이터베이스와 올바르게 상호 작용하여 비즈니스 로직을 실행하는지 테스트합니다.

## 테스트 실행 방법

통합 테스트를 실행하려면 먼저 필요한 종속성을 설치해야 합니다:

```bash
pip install -r requirements.txt
pip install -r requirements-test.txt
```

종속성이 설치되면 `pytest`를 사용하여 테스트를 실행할 수 있습니다:

```bash
pytest tests/integration/
```

이 명령어는 `tests/integration/` 디렉토리에 있는 모든 테스트를 찾아 실행합니다.

## 테스트 환경 설정

통합 테스트는 인메모리 SQLite 데이터베이스를 대상으로 실행되도록 구성되어 있습니다. 이는 외부 데이터베이스 서버 없이도 각 테스트 실행을 위한 빠르고 격리되었으며 재현 가능한 환경을 제공합니다.

테스트 환경 설정은 `tests/integration/conftest.py`에 정의되어 있습니다. 주요 설정 기능은 다음과 같습니다:

- **인메모리 SQLite 데이터베이스:** 각 테스트 함수를 위해 새롭고 깨끗한 인메M모리 SQLite 데이터베이스가 생성됩니다. 데이터베이스 스키마는 각 테스트 시작 시 생성되고 종료 시 제거됩니다.
- **Unit of Work Fixture:** 인메모리 테스트 데이터베이스를 사용하도록 구성된 `UnitOfWork` 인스턴스가 pytest fixture로 제공됩니다. 이를 통해 테스트에서 리포지토리에 쉽게 접근하고 테스트별 데이터베이스 세션 내에서 트랜잭션을 관리할 수 있습니다.
- **사용자 정의 UUID 타입:** 애플리케이션의 네이티브 PostgreSQL `UUID` 타입과 SQLite에 필요한 문자열 기반 UUID 저장소 간의 호환성을 보장하기 위해 사용자 정의 SQLAlchemy `UUID` 타입이 사용됩니다.
